
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Blog kỹ thuật máy tính</title>
	<meta name="author" content="kỹ thuật máy tính">

	
	<meta name="description" content="Jan 3rd, 2015 functional, haskell,, programming Comments Mở đầu về Haskell Chúc mừng năm mới 2015 tới tất cả bạn đọc ktmt blog :) Chúc các bạn một &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Blog kỹ thuật máy tính" type="application/atom+xml">
	
	<link rel="canonical" href="http://git@github.com.github.com/blog/page/2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<img src='/images/logo.jpg' alt='Profile Picture' style='width: 160px;' />
</div>
<h1><a href="/">Blog kỹ thuật máy tính</a></h1>
<p class="subtitle">kỹ thuật máy tính</p>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav class="hint">
	<p style="color: #FFFFFF; margin-top: 2em;">
	  Cập nhật thông tin bài viết qua Facebook page hay link RSS dưới đây
	</p>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="facebook" href="http://www.facebook.com/pages/ktmtgithubio/486208978117754" title="Facebook">Facebook</a>
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>
			</div>
		</div>
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-01-03T14:09:00+09:00" data-updated="true" itemprop="datePublished">Jan 3<span>rd</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/functional/'>functional</a>, <a class='category' href='/blog/categories/haskell/'>haskell,</a>, <a class='category' href='/blog/categories/programming/'>programming</a>


</div>
		
			<span class="comments"><a href="/blog/2015/01/03/mo-dau-ve-haskell/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/01/03/mo-dau-ve-haskell/" itemprop="url">Mở đầu về Haskell</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Chúc mừng năm mới 2015 tới tất cả bạn đọc ktmt blog :) Chúc các bạn một năm mới coding thật productive! ^^</p>
<p>Năm mới chắc hẳn hầu hết mọi người đều có resolution của riêng mình. Một trong những resolution của tôi năm nay là học một ngôn ngữ lập trình mới, đến level có thể viết một chương trình không đơn giản với nó. (Bạn có thể tham khảo một danh sách các resolutions cho programmer ở <a href="http://matt.might.net/articles/programmers-resolutions/">đây</a>). Ngôn ngữ mà tôi chọn là Haskell, một functional programming language, vì những ý tưởng trong ngôn ngữ lập trình này khác hẳn những ngôn ngữ lập trình tôi đã tiếp cận, như C/C++, Java, Python.</p>
<p>Tôi mới bắt đầu với Haskell được một vài tháng, và cảm thấy khá thích thú về những ý tưởng mới mẻ của nó. Tôi sẽ bắt đầu viết chia sẻ những kiến thức tôi thu thập được trong quá trình tìm hiểu ngôn ngữ này trên ktmt. Tuy nhiên, tôi phải nói trước là Haskell khá trừu tượng, và với một beginner như tôi, việc cố diễn giải các khái niệm khó của Haskell có thể sẽ không chính xác và dễ gây hiểu lầm. Vì thế, tôi sẽ tập trung vào viết những đoạn code để giải quyết một vấn đề to hoặc nhỏ nào đó và cố giải thích chúng làm được như thế bằng cách nào. Những khái niệm khó, tôi sẽ dẫn về những bài viết nổi tiếng để bạn đọc có thể tìm hiểu thêm.</p>
<p>Trong bài viết đầu tiên này, tôi sẽ hướng dẫn cách cài đặt những thành phần cơ bản để chúng ta có thể bắt đầu lập trình với Haskell. Cuối bài, sẽ có một chương trình Hello World rất đơn giản để chúng ta test xem môi trường của chúng ta đã hoàn thiện chưa.</p>
<p>Chú ý: Hiện tại tôi test trên máy tính của tôi (Windows 7). Tôi đã từng cài đặt môi trường trên Mac OS X và Ubuntu Linux, nhưng chưa có thời gian kiểm tra lại. Tôi sẽ thêm thông tin nếu cần thiết.</p>
<h1 id="the-haskell-platform">The Haskell Platform</h1>
<p>Đây là cách đơn giản nhất để chúng ta có thể bắt đầu với Haskell. Trên <a href="https://www.haskell.org/platform/">Homepage</a>, Haskell Platform được gọi là “Haskell: batteries included”. Trên homepage này, bạn có thể tải về cả package để cài đặt cho cả ba môi trường: Windows, Linux, Mac OS X. Sau khi cài đặt, bạn sẽ có rất nhiều thành phần tiêu chuẩn để bắt đầu lập trình với Haskell (<a href="https://www.haskell.org/platform/contents.html">List</a>). Trong số đó, có những thành phần tiêu biểu sau:</p>
<h2 id="ghc-glassgow-haskell-compiler">GHC (Glassgow Haskell Compiler)</h2>
<p>Đây là compiler cho Haskell.</p>
<h2 id="ghci">GHCi</h2>
<p>Đây là GHC interactive interpreter. Nếu bạn đã từng lập trình với Python hoặc Ruby, bạn có thể coi GHCi giống như khi bạn gõ <code>python</code> (với Python) hoặc <code>irb</code> (với Ruby) trên command line. GHCi cực kì hữu dụng trong quá trình bạn viết code Haskell.</p>
<p>Bạn sẽ dành khá nhiều thời gian trong GHCi, nên chúng ta sẽ dành chút thời gian để config GHCi sao cho thuận tiện nhất. File config của GHCi là <code>.ghci</code>, vị trí của file này tùy thuộc vào hệ thống bạn đang sử dụng, bạn tham khảo ở đây: <a href="https://downloads.haskell.org/~ghc/7.4.2/docs/html/users_guide/ghci-dot-files.html">GHCi dot files</a>. Tôi tạo mới một file <code>.ghci</code> trong Home folder với nội dung:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'>:set prompt <span class="s2">&quot;h&gt; &quot;</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Làm vậy, mỗi lần mở GHCi, prompt của bạn chỉ đơn giản là <code>h&gt;</code> chứ không phải là tên tất cả các module đã load (bạn hãy thử xem khác nhau như thế nào nếu không có dòng setting trên)</p>
<h2 id="cabal">Cabal</h2>
<p>Cabal là viết tắt của <code>Common Architecture for Building Applications and Libraries</code>. Về chức năng, nó tương tự như <code>pip</code> của Python hay <code>gem</code> của Ruby, dùng để cài đặt những package chuẩn từ <code>Hackage</code> (Haskell Central package archive). Những người viết package sử dụng <code>Hackage</code> để publish các libraries hay programs của họ, và những Haskell programmer khác sử dụng các tool như <code>cabal-install</code> để download và cài đặt các package này.</p>
<p>Trên Windows 7, mỗi khi sử dụng cabal, các package sẽ được install vào <code>$HOME$\AppData\Roaming\cabal</code>. Trên Unix-based system, chúng được install vào <code>~/.cabal/</code>.</p>
<p>Sau đây là những thao tác đầu tiên bạn nên làm với <code>cabal</code>:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span>cabal update
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Dùng để update list các package phiên bản mới nhất trên <code>hackage.haskell.org</code>.</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span>cabal install cabal-install
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Dùng để update phiên bản <code>cabal-install</code> mới nhất</p>
<h1 id="code-editor-sublime-text">Code Editor: Sublime Text</h1>
<p>Bạn có thể dùng bất cứ một text editor nào để viết code Haskell. Nếu bạn sử dụng Sublime Text, bạn nên cài plugin SublimeHaskell. Đây là plugin hỗ trợ Cabal build, error and warning highlighting, smart completion và tích hợp ghc-mod. Bạn có thể tham khảo thêm thông tin tại <a href="https://github.com/SublimeHaskell/SublimeHaskell">GitHub repo</a></p>
<h1 id="cabal-sandbox">Cabal sandbox</h1>
<p>Với Haskell, <code>sandbox</code> cho phép chúng ta build các package một cách độc lập với package environment của hệ thống, bằng cách tạo ra một package environment riêng cho project hiện tại. Nếu bạn đã quen thuộc với Python’s <code>virtualenv</code> hoặc Ruby’s <code>RVM</code>, <code>sandbox</code> là một khái niệm tương tự.</p>
<p><a href="http://coldwa.st/e/blog/2013-08-20-Cabal-sandbox.html">Bài viết này</a> trình bày khá dễ hiểu về tại sao nên sử dụng <code>sandbox</code> để tránh dependency hell, bạn có thể tham khảo thêm. Một số thao tác cơ bản với cabal sandbox gồm có:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /path/to/my/haskell/project
</span><span class='line'><span class="nv">$ </span>cabal sandbox init                    <span class="c"># Init the sandbox</span>
</span><span class='line'><span class="nv">$ </span>cabal install --only-dependencies     <span class="c"># Install dependencies into the sandbox</span>
</span><span class='line'><span class="nv">$ </span>cabal build                           <span class="c"># Build your package inside the sandbox</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Chú ý ở đây, cabal sandbox là một feature của cabal từ version 1.18 trở đi, cho nên sau khi init một sandbox hoàn toàn mới, các command tiếp theo (như <code>build</code> hay <code>install</code>) đều sẽ sử dụng sandbox chứ không phải package environment của hệ thống.</p>
<h1 id="ví-dụ-đầu-tiên-hello-world">Ví dụ đầu tiên: Hello World</h1>
<p>Chúng ta sẽ bắt đầu với ví dụ muôn thuở khi bắt đầu ngôn ngữ lập trình mới: In ra màn hình consle dòng chữ <code>Hello World</code>.</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir haskell-hello-world
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>haskell-hello-world
</span><span class='line'><span class="nv">$ </span>cabal init
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p><code>cabal init</code> sẽ giúp chúng ta thêm thông tin cho project của mình, như: tên project, version, người phát triển, license,…</p>
<p>Tiếp theo, chúng ta edit file Cabal. Ví dụ sau khi edit, file <code>haskell-hello-world.cabal</code> của tôi có nội dung như sau:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre>
</td>
<td class="code">
<pre><code class='haskell'><span class='line'><span class="nf">name</span><span class="kt">:</span>                <span class="n">haskell</span><span class="o">-</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</span><span class='line'><span class="nf">version</span><span class="kt">:</span>             <span class="mf">0.1</span><span class="o">.</span><span class="mf">0.0</span>
</span><span class='line'><span class="nf">synopsis</span><span class="kt">:</span>            <span class="kt">Hello</span> <span class="kt">World</span><span class="o">!</span>
</span><span class='line'><span class="nf">description</span><span class="kt">:</span>         <span class="kt">Print</span> <span class="sc">&#39;Hello World&#39;</span> <span class="n">to</span> <span class="n">console</span> <span class="n">screen</span>
</span><span class='line'><span class="nf">license</span><span class="kt">:</span>             <span class="kt">BSD3</span>
</span><span class='line'><span class="nf">license</span><span class="o">-</span><span class="n">file</span><span class="kt">:</span>        <span class="kt">LICENSE</span>
</span><span class='line'><span class="nf">author</span><span class="kt">:</span>              <span class="kt">Viet</span> <span class="kt">Nguyen</span><span class="p">,</span> <span class="mi">2015</span>
</span><span class='line'><span class="nf">maintainer</span><span class="kt">:</span>          <span class="n">viet</span><span class="o">.</span><span class="n">nguyen182</span><span class="o">@</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="nf">copyright</span><span class="kt">:</span>           <span class="kt">Viet</span> <span class="kt">Nguyen</span>
</span><span class='line'><span class="nf">category</span><span class="kt">:</span>            <span class="kt">Text</span>
</span><span class='line'><span class="nf">build</span><span class="o">-</span><span class="kr">type</span><span class="kt">:</span>          <span class="kt">Simple</span>
</span><span class='line'><span class="nf">cabal</span><span class="o">-</span><span class="n">version</span><span class="kt">:</span>       <span class="o">&gt;=</span><span class="mf">1.10</span>
</span><span class='line'>
</span><span class='line'><span class="nf">executable</span> <span class="n">haskell</span><span class="o">-</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</span><span class='line'>  <span class="n">ghc</span><span class="o">-</span><span class="n">options</span><span class="kt">:</span>         <span class="o">-</span><span class="kt">Wall</span>
</span><span class='line'>  <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="kt">:</span>      <span class="n">src</span>
</span><span class='line'>  <span class="n">main</span><span class="o">-</span><span class="n">is</span><span class="kt">:</span>             <span class="kt">Main</span><span class="o">.</span><span class="n">hs</span>
</span><span class='line'>  <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="kt">:</span>       <span class="n">base</span> <span class="o">&gt;=</span><span class="mf">4.7</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="mf">4.8</span>
</span><span class='line'>  <span class="kr">default</span><span class="o">-</span><span class="n">language</span><span class="kt">:</span>    <span class="kt">Haskell2010</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Một số điểm lưu ý từ file cabal trên:</p>
<ul>
<li>Đặt <code>hs-source-dirs</code> là thư mục <code>src</code> để Cabal biết nơi lưu các file modules</li>
<li>Đặt <code>main-is</code> thành <code>Main.hs</code> để compiler biết đầu là main function của file binary build ra</li>
<li><code>ghc-options</code> đặt thành <code>-Wall</code> để chúng ta có thể thấy các Warning từ GHC</li>
<li><code>build-depends</code> là nơi khai báo các library cần sử dụng, có thể kèm theo các option về yêu cầu version.</li>
</ul>
<p>File code của chúng ta nằm ở <code>src/Main.hs</code> có nội dung như sau:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre>
</td>
<td class="code">
<pre><code class='haskell'><span class='line'><span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="s">&quot;Hello World!&quot;</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Đây là một module rất đơn giản, và vì nó được dùng làm target cho <code>main-is</code>, nó phải có một function tên <code>main</code> và tên của module cũng phải tên là <code>Main</code>. Hiện tại, bạn chưa cần để ý vội đến cú pháp mà chỉ cần biết rằng chương trình in ra màn hình dòng chữ “Hello World!”. (Chú ý: Có thể bạn sẽ nghĩ <code>putStrLn</code> tương tự như <code>printf</code> hay <code>cout</code> ở C/C++, nhưng với Haskell, nguyên lý sẽ khác hơn so với bạn nghĩ, nhưng đó là câu chuyện ở những bài viết sau này.)</p>
<p>Tiếp theo, chúng ta tạo một Cabal sandbox để chứa toàn bộ các dependencies (ví dụ Hello World này của tôi hơi trivial, vì không dùng library nào cả, nhưng vì tính đầy đủ, tôi vẫn xin trình bày về sandbox ở đây):</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span>cabal sandbox init
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Sau bước này, chúng ta sẽ có file <code>cabal.sandbox.config</code> chứa thông tin về package environment, và sandbox nằm ở thư mục <code>.cabal-sandbox</code></p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span>cabal install --only-dependencies
</span><span class='line'><span class="nv">$ </span>cabal install
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Nếu build thành công, bạn sẽ có file binary <code>haskell-hello-world</code> ở <code>dist/build/haskell-hello-world</code>. Thử chạy nó xem sao:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre>
</td>
<td class="code">
<pre><code class='bash'><span class='line'><span class="nv">$ </span>./dist/build/haskell-hello-world/haskell-hello-world
</span><span class='line'>Hello World!
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Và chúng ta đã build thành công program đầu tiên!</p>
<h1 id="kết-luận">Kết luận</h1>
<p>Bài viết này là bài viết đầu tiên của tôi về Haskell. Chưa có gì nhiều về syntax, idea, concept, mà chỉ là những setup ban đầu để dễ dàng bắt đầu với Haskell. Trong những bài viết tiếp theo, tôi sẽ cố gắng từng bước một trình bày các ý tưởng của Haskell một cách dễ hiểu.</p>
<p>Hẹn gặp lại!</p>
		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-12-15T16:56:00+09:00" data-updated="true" itemprop="datePublished">Dec 15<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/mysql/'>mysql</a>, <a class='category' href='/blog/categories/type/'>type</a>


</div>
		
			<span class="comments"><a href="/blog/2014/12/15/tam-quan-trong-cua-kieu-du-lieu/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/12/15/tam-quan-trong-cua-kieu-du-lieu/" itemprop="url">“Tầm Quan Trọng Của Kiểu Dữ Liệu”</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1 id="mở-đầu">Mở đầu</h1>
<p>2h sáng. “beep, you’ve got mail”. Mail từ hệ thống giám sát zabbix.</p>
<p>1 URL quan trọng trong hệ thống web không hiển thị được. Truy cập vào URL đó nhận status code http trả về 503. Zabbix định kỳ kiểm tra mã lỗi và khi mã trả về khác 200, <a href="zabbix.com">zabbix</a> gửi mail cho hắn.</p>
<p>“Lại có vấn đề gì rồi đây…” — hắn vùng dậy, mở laptop lên, mở browser ra và truy cập thử vào URL được thông báo. “Quả nhiên là không vào được”, hắn nghĩ. Ssh thử vào một máy chủ và kiểm tra error log. Thông báo lỗi “Không truy cập được đến máy chủ cơ sở dữ liệu X” liên tiếp liên tiếp được ghi ra log. “Máy chủ X lại có vấn đề gì rồi đây …”. Hắn vừa nghĩ, mắt vừa lướt qua các đồ thị giám sát tài nguyên của toàn bộ hệ thống. “Lưu lượng truy cập vào máy chủ web vẫn bình thường. Tỉ lệ cachehit vẫn không đổi. Mọi thứ không có gì có vẻ bất thường. Vậy vấn đề này ở máy chủ X rồi”. Hắn nghĩ, rồi gõ</p>
<div>
<pre><code class='bash'>ssh X</code></pre>
</div>
<h1 id="truy-tìm">Truy tìm</h1>
<p>X là một máy chủ cơ sở dữ liệu chạy mysql, 4 cores 24GB Ram 2 đĩa cứng 300GB RAID 1. Không quá yếu nhưng cũng không quá khoẻ. Vì là máy chủ cơ sở dữ liệu nên phần lớn tài nguyên của X được dùng cho mysql.</p>
<p>“Để xem chú mày bị làm sao nhé!” - hắn bắt đầu công đoạn chẩn đoán bệnh của máy chủ.</p>
<p>Sau khi vào máy chủ X, hắn gõ top. Lệnh top hiện ra máy chủ có 4 cores, tất cả đều có %cpu xấp xỉ 95%. Hắn gõ <a href="http://linux.die.net/man/1/iostat">iostat</a> 1, và quan sát I/O của đĩa cứng. <a href="http://en.wikipedia.org/wiki/Transfer_%28computing%29">TPS</a> (Trasfer per second) biến động từ 131.89 xuống đến 19.00. tps trung bình không cao. Blk_wrtn/s và Blk_read/s cũng biến động nhưng trung bình cũng không cao.</p>
<p>“CPU hoạt động cật lực trong khi đấy I/O thì không quá lớn”, hắn ghi lại điểm quan trọng này trong đầu. Ghi nhớ xong, hắn tiếp tục mở slow query log ra xem. Log này ghi lại những query mà mysql chạy quá lâu hơn 1s. 1 loạt query kiểu</p>
<pre><code>select * from table_name where video_id in (12345, ‘23434’) and language = ‘en-us’;</code></pre>
<p>được ghi ra log.</p>
<p>Query trên có 2 điểm rất kỳ lạ.</p>
<ul>
<li>Thứ nhất name được query theo cả kiểu số và xâu dữ liệu.</li>
<li>Thứ hai query trên khá đơn giản, lệnh show table status like ‘table_name’ cho hắn kết quả số dòng chỉ khoảng 70000 dòng - 1 con số không lớn. Vậy mà X phải hoạt đông 95% cpu mà vẫn không thể nào trả về kết quả câu lệnh trên trong 1s.</li>
</ul>
<div>
<pre><code class='bash'>$ mysql -u root -p
Enter password: ***********
mysql&gt; use database database_name;
mysql&gt; show table status like ‘table_name’\G;
*************************** 1. row ***************************
           Name: table_name
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 72148
 Avg_row_length: 924
    Data_length: 66732032
Max_data_length: 0
   Index_length: 14630912
      Data_free: 7340032
 Auto_increment: NULL
    Create_time: 2013-10-11 18:33:07
    Update_time: NULL
     Check_time: NULL
      Collation: utf8_general_ci
       Checksum: NULL
 Create_options:
        Comment: Latest translation for vid</code></pre>
</div>
<p>Để xem chú mày đang bận rộn xử lý cái gì nhé.</p>
<div>
<pre><code class='bash'>mysql&gt; show process list;

1 loạt query kiểu 

“select * from table_name where video_id in (12345, ‘23434’) and language = ‘en-us’;”</code></pre>
</div>
<p>“beep, you’ve got mail”. Một mail mới lại về. Máy chủ web đã không thể nào truy cập được X. Zabbix thông báo bản thân zabbix cũng không thể nào truy cập máy chủ X để lấy thông tin giám sát.</p>
<p>“Tình huống có vẻ nghiêm trọng lên.” hắn lẩm bẩm.</p>
<p>Máy chủ bận rộn CPU, I/O không lớn chứng tỏ là query trên tốn rất nhiều CPU. Có lẽ CPU đang tốn thời gian để sắp xếp và tìm kiếm, một mình chứng của việc mysql đang phải tìm với 1 lượng dữ liệu lớn. 70000 không phải con số to, do vậy chỉ có thể là máy chủ X đang phải tìm kiếm mà không có chỉ mục (index)!</p>
<p>“Không lẽ nào!”, vừa nói hắn vừa gõ lệnh</p>
<div>
<pre><code class='bash'>mysql&gt; show index from table_name;

+-------------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+
| Table       | Non_unique | Key_name          | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment |
+-------------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+
| table_name  |          0 | PRIMARY           |       1      | id          | A         |     73908   |     NULL | NULL   |      | BTREE      |         |
| table_name  |          0 | PRIMARY           |       2      | language    | A         |     73908   |     NULL | NULL   |      | BTREE      |         |
| table_name  |          1 | idx_table_name_1  |       1      | user_id     | A         |     24636   |     NULL | NULL   |      | BTREE      |         |
+-------------+------------+-------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+</code></pre>
</div>
<p>Rất buồn, vậy là video_id có gắn index đàng hoàng. Vậy thì không có lý do gì mà query trên lại không query theo index cả. Thật kỳ lạ. Vậy để thử xem query trên có dùng index không nhé. Đoạn hắn lấy 1 query bất kỳ và thử <a href="http://dev.mysql.com/doc/refman/5.6/en/explain.html">EXPLAIN</a>.</p>
<div>
<pre><code class='bash'>mysql&gt; explain SELECT * FROM table_name WHERE `video_id` IN (1412240325) AND `language` = “en-us”\G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: table_name
         type: ALL
possible_keys: PRIMARY,idx_table_name_2
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 66870
        Extra: Using where
1 row in set (0.00 sec)

ERROR:
No query specified</code></pre>
</div>
<p><em>key: NULL</em> nghĩa là query trên không sử dụng index! Tại sao bảng có chỉ mục mà query lại không dùng index. Chắc chắn là video_id có vấn đề rồi. Vừa nghĩ hắn vừa gõ câu lệnh show create table để xem kiểu dữ liệu lúc tạo bảng.</p>
<div>
<pre><code class='bash'>mysql&gt; show create table table_name;
table_name | CREATE TABLE `table_name` (
  `video_id` varchar(34) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,
  `language` varchar(32) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,
  `user_id` int(10) unsigned NOT NULL,
  PRIMARY KEY (`video_id`,`language`),
  KEY `idx_videotranslationinfo_1` (`user_id`),
  KEY `idx_videotranslationinfo_2` (`video_id`),
  KEY `idx_videotranslationinfo_3` (`language`),
  ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#39;Latest translation for videos.&#39; |</code></pre>
</div>
<p>Có gì đó không ổn. Query thì coi video_id như là kiểu số nguyên, trong khi bảng lại định nghĩa video_id kiểu xâu dữ liệu. Có lẽ việc khác nhau trong kiểu dữ liệu này làm mysql không so sánh được truy cập với index, làm cho mysql sẽ tìm bản ghi bằng cách lặp toàn bộ bảng. Suy nghĩ vậy, hắn liền thử explain 1 query sau khi đã thay số bằng chữ.</p>
<div>
<pre><code class='bash'>mysql&gt; explain SELECT * FROM table_name WHERE `video_id` IN (“1412240325”) AND `language` = “en-us”\G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: table_name
         type: ALL
possible_keys: PRIMARY,idx_table_name_2
          key: PRIMARY
      key_len: NULL
          ref: NULL
         rows: 66870
        Extra: Using where
1 row in set (0.00 sec)

ERROR:
No query specified</code></pre>
</div>
<p>“Ồ la la” hắn khẽ reo lên.</p>
<p>Sau khi đổi video_id thành kiểu chuỗi thì index đã được sử dụng <em>key: PRIMARY</em>. Hắn ngay lập tức liên lạc với bên phát triển và để sửa đoạn code sinh ra query trên. Bên phát triển lập tức tìm ra có 1 dòng code chưa gọi strval để biến video_id thành xâu dữ liệu trước ném query cho DB. Bên phát triển lập tức sửa source code và cập nhật phiên bản mới nhất lên máy chủ. Ngay lập tức %cpu của X trở về 1%. Trang web lại vào bình thường như chưa từng có gì cản trở. Slow log query cũng dừng log query hẳn.</p>
<h1 id="bài-học">Bài học</h1>
<p>Index thật quan trọng và Kiểu dữ liệu cũng rất quan trọng.</p>
<p>Hắn khoái trí khi phát hiện ra hiểu ra được thêm 1 nguyên lý hoạt động của mysql cũng như ảnh hưởng của máy chủ X lên toàn bộ hệ thống. Đôi khi chỉ 1 mặt xích sai sót trong cả 1 dây chuyền có thể phá huỷ toàn bộ dây chuyền - hắn lờ mờ suy nghĩ và ngủ gục. Giờ là 4h sáng.</p>
		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-09T17:16:00+09:00" data-updated="true" itemprop="datePublished">Nov 9<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/advertising/'>advertising</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/09/doi-dieu-ve-he-thong-quang-cao/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/09/doi-dieu-ve-he-thong-quang-cao/" itemprop="url">Đôi điều về Hệ Thống Quảng Cáo (Phần 1)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1 id="lời-nói-đầu">1. Lời nói đầu</h1>
<p>Là một lập trình viên, tôi có thể khẳng định một điều là tôi <strong><em>ghét quảng cáo</em></strong>! Và tôi chắc chắn 90% các bạn cũng ghét quảng cáo như tôi. Bằng chứng là bạn đang cài adblock extension cho chrome hoặc firefox, hay là chúng ta hay đem hình tượng ‘kangaroo’ (một quảng cáo đã trở thành hiện tượng khi phát vào chung kết C1 năm 2011) là một hình tượng cho sự ‘xấu xa’, ‘phiền phức’ của quảng cáo.</p>
<p>Chúng ta cũng hay dùng quảng cáo như là thước đo cho chất lượng của một kênh truyền hình hay là trang web, ví dụ như: ‘vtv3 dạo này toàn quảng cáo’, hay là ‘trang web abcxyz toàn quảng cáo, lừa đảo đó!’.</p>
<p>Vậy lý do làm sao chúng ta lại ghét quảng cáo đến vậy? Có lẽ nguyên nhân lớn nhất là chúng <strong>cản trở</strong> chúng ta đến với dịch vụ (che tầm nhìn của trang web hay ti vi), và chúng hiển thị những thông tin mà chúng ta coi là <strong>dư thừa</strong>, không cần thiết. Tuy nhiên có phải vì thế mà quảng cáo chỉ toàn điều xấu và không đáng tồn tại?</p>
<p>Tuy nhiên, hãy nhìn vào mặt tốt của quảng cáo một chút</p>
<ul>
<li>Quảng cáo giúp những người làm sản phẩm có cơ hội được khách hàng biết đến. Nếu không có quảng cáo thì những sản phẩm chưa được biết đến hầu như không có cơ hội ‘ngoi lên’ trên thị trường.</li>
<li>Quảng cáo giúp người tiêu dùng gặp được những sản phẩm có ích (mặc dù theo cách rất tình cờ)</li>
<li>Quảng cáo giúp cho các trang web miễn phí, các nhà phát triển app trên điện thoại miễn phí có nguồn doanh thu để tạo ra các sản phẩm có ích cho chúng ta dùng.</li>
</ul>
<p>Vậy nếu nhìn theo những hướng tích cực này thì quảng cáo không hề xấu, chỉ có cách thức tiến hành quảng cáo tồi đã gây nên những hình ảnh thiếu tích cực với quảng cáo. Vậy với tư cách là người tiêu dùng, chúng ta cần một hệ thống quảng cáo thông minh hơn, mà không <strong>cản trở</strong>, cũng như cung cấp những thông tin quảng cáo có ích, phù hợp hơn đúng không?</p>
<p>Thực tế thì hệ thống quảng cáo đã và đang thay đổi hàng ngay để thông minh hơn, đến đúng người dùng hơn. Trong bài viết này tôi sẽ giới thiệu qua về hệ thống quảng cáo trên internet nói chung, về khái niệm cũng như cách thức vận hành của chúng. Qua đó bạn sẽ hiểu tại sao google lại chỉ có thể sống được mà chỉ nhờ có quảng cáo, bạn cũng hiểu được tại sao facebook, twitter sẵn sàng cung cấp dịch vụ miễn phí cho bạn. Để bắt đầu, trước tiên chúng ta sẽ đến với các thuật ngữ chuyên môn được sử dụng trong hệ thống quảng cáo.</p>
<h1 id="các-thuật-ngữ">2. Các thuật ngữ</h1>
<p>Do hệ thống quảng cáo ở Việt Nam còn khá non nớt và thô sơ, nên các thuật ngữ trong ngành ít được phổ biến rộng rãi bằng tiếng Việt, do đó ở dưới đây tôi sẽ nói về các thuật ngữ bằng tiếng Anh.</p>
<h2 id="thuật-ngữ-chung">Thuật ngữ chung</h2>
<ul>
<li><strong><em>Media</em></strong> (hay còn gọi là publisher): media bạn có thể hiểu là các trang web (vd như vnexpress), hay các mobile application (vd như flappy bird). Media là nơi có nhiều user tập trung, và cũng là nơi để đặt quảng cáo.</li>
<li><strong><em>Advertiser</em></strong>: Là những người nắm(own) quảng cáo. Advertiser bạn có thể hình dung là các doanh nghiệp muốn đưa hình ảnh của mình đến người dùng, vd như cocacola, piagio, adidas…</li>
<li><strong><em>Click</em></strong>: Là một trong những đơn vị để tính đơn giá của quảng cáo. Khi người dùng ‘click’ vào một banner quảng cáo của advertiser, advertiser sẽ phải trả tiền cho click đó (trả tiền cho ‘ai’ thì chúng ta sẽ hiểu được ở các phần tiếp theo)</li>
<li><strong><em>Impression</em></strong>: Cũng là một đơn vị để tính đơn giá của quảng cáo. 1 impression có thể hiểu đơn giản là 1 ‘view’, tức là khi 1 user ‘nhìn’ thấy một quảng cáo, advertiser sở hữu quảng cáo đó sẽ phải trả tiền.</li>
<li><strong><em>Conversion</em></strong>: Khi người dùng nhìn quảng cáo, bấm vào trang web của advertiser, mua hàng hay trở thành khách hàng của advertiser, toàn bộ quá trình đó được gọi là ‘converse’, do đó chỉ số conversion(CV) được dùng để ám chỉ độ hiệu quả của quảng cáo.</li>
<li><strong><em>Conversion Rate(CVR)</em></strong>: Là tỉ lệ converse chia cho số lượng truy cập vào website của advertiser.</li>
<li><strong><em>Click Per Cost(CPC)</em></strong>: Nhà quảng cáo phải mất bao nhiêu tiền để có được 1 click của user.</li>
<li><strong><em>Click Through Rate(CTR)</em></strong>: Là số click / số impression. Chỉ số này cho thấy ‘độ hiệu quả’ của 1 quảng cáo.</li>
<li><strong><em>Cost Per Acquisition(CPA)</em></strong>: Là số tiền tốn để ‘kiếm’ được một khách hàng thực thụ (khách hàng trả tiền hay mua hàng của advertiser).</li>
<li><strong><em>ROI(Return on Investment)</em></strong>: Đây là số tiền để đánh giá độ hiệu quả của một ‘chiến dịch’ quảng cáo. Một chiến dịch quảng cáo advertiser có thể tung ra ở rất nhiều nơi, sử dụng rất nhiều banner khác nhau. ROI là số tiền thu được sau chiến dịch quảng cáo đó / số tiền advertiser đã đầu tư và chiến dịch đó.</li>
</ul>
<h2 id="thuật-ngữ-về-hệ-thống-kĩ-thuật">Thuật ngữ về hệ thống kĩ thuật:</h2>
<ul>
<li><strong><em>Ad-Network</em></strong>: là một ‘mạng lưới’ các media (các website hay các application). Sẽ có các công ty nắm các ad-network này. Đặc điểm của các công ty đó là họ sẽ có chiến lược để ‘phân phối’ (deliver) các quảng cáo đến các media thích hợp để tăng lợi nhuận cho họ cũng như bên media.</li>
<li><strong><em>Ad-Exchange</em></strong>: Đây là một trong những bước tiến lớn để giúp quảng cáo thông minh hơn. Adexchange là một hệ thống nằm trung gian giữa Media và Advertiser, giúp ‘trao đổi’ quảng cáo giữa các advertiser. Bạn có thể hình dung Ad-Exchange giống như một sàn chứng khoán, mà những người chơi chứng khoán là các advertiser.</li>
<li><strong><em>Realtime-Bidding</em></strong>: Là hệ thống đi kèm với Ad-Exchange, giúp việc ‘trao đổi’, ‘mua bán’ quảng cáo được diễn ra tại thời gian thực. Bạn có thể hình dung có một thời điểm có một cô gái xinh đẹp vừa mua hàng của LV cách đây 2 ngày (hệ thống quảng cáo biết được việc này thông qua cookie) vào trang web X. Tại ngày thời điểm cô gái request đến X, X sẽ tung ra một món hàng là impression của cô gái này. Các advertiser của NineWest hay H&amp;M sẽ đấu giá với nhau để mua impression của cô gái (và tất nhiên là ai chịu chơi hơn sẽ thắng). Người chiến thắng sẽ được hệ thống ‘vận chuyển’ quảng cáo của mình trở lại X, và có được impression của cô gái. Hệ thống giúp đấu giá nói trên chính là RTB.</li>
<li><strong><em>DSP (Demand Side Platform)</em></strong>: Là một hệ thống được sử dụng bởi các advertisers. Bạn có thể hình dung advertiser sử dụng DSP như một hệ thống cung cấp cánh của để bước vào thế giới của Ad-network và Ad-Exchage. DSP giúp quản lý một lúc nhiều Ad-network, Ad-exchange, giúp advertiser thống nhất cùng một user ở các media khác nhau (thông qua cookie), giúp advertiser sử dụng RTB và còn rất nhiều chức năng thông minh khác.</li>
<li><strong><em>SSP (Supply Side Platform)</em></strong>: Khác với DSP ở phía ‘gần’ với advertiser hơn, SSP ở phía gần với media hơn. SSP giúp media quản lý nhiều Ad-Network, Ad-Exchange khác nhau, giúp cho media có thể tăng lợi nhuận cho mình. Mỗi khi có một user truy cập vào media, media sẽ sử dụng SSP để chọn ra quảng cáo có giá trị tiền cao nhất. Giống như DSP, SSP là cách cửa giúp media bước vào thế giới của Ad-Network, Ad-Exchange.</li>
<li><strong><em>Retargeting</em></strong>: Đây là một kĩ thuật được sử dụng rất phổ biến trong quảng cáo. Giả sử có một cô gái xinh đẹp vào trang web của LV, ngẵm nghĩa một chiếc túi xách, xong do không có tiền, cô ấy rời khỏi trang web mất :(. Vài ngày sau, cô gái vào trang tin tức Y, đột nhiên thấy quảng cáo về chiếc túi xách cô ấy mong ước, rất may cô ấy đã nhận lương. Và nhờ thế cô ấy đã click vào quảng cáo của LV, và đôi bên cùng có lợi. Kĩ thuật giúp thực hiện quá trình tren được gọi là Re-targeting.</li>
</ul>
<p>Như vậy chúng ta đã có các khái niệm hết sức cơ bản về các thuật ngữ sử dụng trong quảng cáo, để có cái nhìn đầu tiên cho các bài viết tiếp theo. Trong phần tiếp chúng ta sẽ tiếp tục nói về:</p>
<ul>
<li>Phân loại hệ thống quảng cáo</li>
<li>Kiến trúc hệ thống quảng cáo</li>
</ul>
		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/blog/page/3/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    kỹ thuật máy tính


</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'ktmt';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41828637-2', 'ktmt.github.io');
  ga('send', 'pageview');

</script>	


		</div>
	</div>
</body>
</html>
