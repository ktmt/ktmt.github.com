
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Blog kỹ thuật máy tính</title>
	<meta name="author" content="kỹ thuật máy tính">

	
	<meta name="description" content="Sep 23rd, 2014 computer, image, opencv, processing,, python,, vision, Comments Xử Lý ảnh Bằng Python và OpenCV: Mở đầu Do công việc, tôi đã có một &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Blog kỹ thuật máy tính" type="application/atom+xml">
	
	<link rel="canonical" href="http://git@github.com.github.com/blog/page/4/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	
</head>


<body>
	<div class="notif">
		<p>
			Cảm ơn bạn đã đọc và ủng hộ blog KTMT ʘ‿ʘ
			Từ bây giờ chúng tôi sẽ là
			<a target="_blank" href="/blog/2015/05/06/kipalog-cau-chuyen-ve-viet-va-chia-se/">
				kipalog.com
			</a>
			!
		</p>
	</div>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<img src='/images/logo.jpg' alt='Profile Picture' style='width: 160px;' />
</div>
<h1><a href="/">Blog kỹ thuật máy tính</a></h1>
<p class="subtitle">kỹ thuật máy tính</p>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav class="hint">
	<p>
	  Cập nhật thông tin bài viết qua Facebook page hay link RSS dưới đây
	</p>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="facebook" href="http://www.facebook.com/pages/ktmtgithubio/486208978117754" title="Facebook">Facebook</a>
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>
			</div>
		</div>
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-09-23T19:04:00+09:00" data-updated="true" itemprop="datePublished">Sep 23<span>rd</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/computer/'>computer</a>, <a class='category' href='/blog/categories/image/'>image</a>, <a class='category' href='/blog/categories/opencv/'>opencv</a>, <a class='category' href='/blog/categories/processing/'>processing,</a>, <a class='category' href='/blog/categories/python/'>python,</a>, <a class='category' href='/blog/categories/vision/'>vision,</a>


</div>
		
			<span class="comments"><a href="/blog/2014/09/23/xu-ly-anh-bang-python-va-opencv-mo-dau/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/09/23/xu-ly-anh-bang-python-va-opencv-mo-dau/" itemprop="url">Xử Lý ảnh Bằng Python và OpenCV: Mở đầu</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Do công việc, tôi đã có một thời gian tìm hiểu về OpenCV để xử lý ảnh và video. Phần lớn các tác vụ tôi thực hiện là code OpenCV trên C++ và giao tiếp với Android qua JNI. Và rồi tôi nhận ra mình chỉ làm theo những tutorial có sẵn trên mạng và mất nhiều thời gian hơn mức cần thiết để fix bug của compiler hoặc IDE. Bản thân tôi rất có hứng thú với Computer Vision và Image Processing nói chung, nhưng cách tiếp cận như trên có vẻ như quá chậm. Sẽ tốt hơn nếu có thể tập trung nắm được những khái niệm cơ bản cùa Computer Vision trước, không bị sa đà vào việc fix bug. Bản thân việc nhanh chóng tạo ra những ứng dụng hữu ích là một động lực không nhỏ đối với việc tiếp tục học Computer Vision and Image Processing.</p>
<p>Đó là lý do tôi chuyển sang lập trình OpenCV với Python. Việc cài đặt, viết code, thử nghiệm đều trở nên đơn giản hơn rất nhiều.</p>
<p>Thêm một lý do nữa, phải nói là Computer Vision và Image Processing là những lĩnh vực khó nếu xét về khía cạnh nghiên cứu, với rất nhiều công thức toán. Tôi không nói những công thức toán đó là không cần thiết, mà là đối với người bắt đầu học, sẽ tốt hơn nếu nhanh chóng nắm được tất cả những kĩ thuật cơ bản và bắt đầu áp dụng xây dựng ứng dụng hữu ích cho mình. Sau đó, tuỳ theo nhu cầu và sở thích, có thể tiếp tục đào sâu nghiên cứu, tối ưu, chạy thời gian thực… Kể cả lúc đó, khi đã có kiến thức cơ bản rồi, việc tiếp cận sẽ càng nhanh hơn.</p>
<p>Xin lỗi vì phần giới thiệu hơi dài dòng :P Tôi xin bắt đầu luôn. Trong bài đầu tiên này, tôi sẽ trình bày cách cài đặt môi trường và một số tác vụ cơ bản khi làm việc với OpenCV trên Python. Bài viết này có thể sẽ khá cơ bản với một số độc giả, nhưng vì là bài đầu tiên trong loạt bài này, tôi vấn muốn trình bày để đảm bảo sự đầy đủ. Trong các bài sau, chúng ta sẽ cùng xây dựng những ứng dụng thú vị hơn.</p>
<h1 id="cài-đặt-môi-trường">Cài đặt môi trường</h1>
<p>Có những thành phần sau cần phải cài đặt để làm việc với OpenCV trên : * Python 2.7 * NumPy và SciPy: Bằng cách sử dụng NumPy, chúng ta có thể biểu thị hình ảnh bằng mảng đa chiều. Ngoài ra, có rất nhiều thư viện xử lý ảnh và cả machine learning sử dụng cách biểu thị mảng của NumPy. NumPy cũng hỗ trợ rất nhiều hàm toán học chúng ta có thể thực hiện nhiều phân tích có ý nghĩa hơn trên ảnh. Bên cạnh NumPy còn có SciPy đi kèm, hỗ trợ thêm về các tính toán khoa học.</p>
<p>Trên Windows, cách dễ nhất để có cả Python, NumPy và SciPy là cài đặt Enthought Canopy tại <a href="https://www.enthought.com/products/canopy/" class="uri">https://www.enthought.com/products/canopy/</a></p>
<p>Trên Mac từ 10.7 trở lên, NumPy và SciPy đã được cài đặt sẵn. * Matplotlib: là thư viện để plot. Khi xử lý ảnh, chúng ta sẽ sử dụng thư viện này để xem histogram của ảnh hoặc xem chính ảnh đó. * OpenCV: Về hướng dẫn cài đặt chi tiết, bạn có thể xem tại <a href="http://docs.opencv.org/doc/tutorials/introduction/table_of_content_introduction/table_of_content_introduction.html">đây</a></p>
<h1 id="mở-và-lưu-file-ảnh">Mở và lưu file ảnh</h1>
<p>Hãy bắt đầu bằng tác vụ đơn giản nhất: mở một file ảnh thành một mảng NumPy, đọc các thông tin về kích cỡ, sau đó lưu mảng NumPy thành một file ảnh mới.</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span>getinfo.py </span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre>
</td>
<td class="code">
<pre><code class='py'><span class='line'><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">cv2</span>
</span><span class='line'>
</span><span class='line'><span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class='line'><span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">,</span> <span class="s">&quot;--image&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
</span><span class='line'>                <span class="n">help</span> <span class="o">=</span> <span class="s">&quot;Path to the image&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">ap</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&quot;image&quot;</span><span class="p">])</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;width: </span><span class="si">%d</span><span class="s"> pixels&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;height: </span><span class="si">%d</span><span class="s"> pixels&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;channels: </span><span class="si">%d</span><span class="s"> channels&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s">&quot;new.jpg&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Đầu tiên, chúng ta import hai package cần thiết là <code>argparse</code> và <code>cv2</code>. <code>argparse</code> dùng để khai báo những parameter cần thiết cho chương trình của chúng ta, ở đây, chúng ta khai báo parameter là đường dẫn đến file ảnh ban đầu. Để đọc file ảnh thành một mảng NumPy, chúng ta sử dụng hàm <code>cv2.imread()</code> với parameter là tên file ảnh (đã được nhập vào từ command line). Sau bước này, ta nhận được một mảng NumPy là <code>image</code>. Tiếp theo ta in ra các thông số về file ảnh, gồm có chiều dài, chiều rộng và số channel. Ở đây, chúng ta có những điểm lưu ý về cách NumPy lưu các thông số về bức ảnh: * Một bưc ảnh có 2 chiều X và Y, gốc toạ độ tại pixel trên cùng bên trái của bức ảnh. Chiều X từ trái sang phải và chiều Y từ trên xuống dưới. NumPy lưu số pixel hơi ngược: <code>image.shape[0]</code> là số pixel theo chiều Y và <code>image.shape[1]</code> là số pixel theo chiều X. * Mỗi pixel trên bức ảnh được biểu thị dưới một trong 2 dạng: grayscale hoặc color. <code>image.shape[2]</code> lưu số channel biểu thị mỗi pixel. Với ảnh màu hiển thị trên RGB, số channel là 3, còn với ảnh đen trắng (grayscale), chúng ta chỉ có 1 channel duy nhất</p>
<p>Để hiển thị bức ảnh trên một window mới, ta sử dụng hàm <code>cv2.imshow()</code>, với 2 đối số là tên của window và tên của mảng NumPy muốn hiển thị.</p>
<p>Để lưu mảng NumPy thành một file ảnh mới, ta sử dụng hàm <code>cv2.imwrite()</code>, với 2 đối số là tên của file muốn lưu và tên của mảng NumPy. Trong ví dụ này, chúng ta lưu file mới giống hệt file cũ mà không có chỉnh sửa gì.</p>
Chạy đoạn code trên như sau:
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
</pre>
</td>
<td class="code">
<pre><code class=''><span class='line'>% python getinfo.py -i obama_fun.jpg</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Ảnh gốc:</p>
<img src="/images/pythonopencv/original.gif"> Kết quả trả về
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre>
</td>
<td class="code">
<pre><code class=''><span class='line'>width: 475 pixels
</span><span class='line'>height: 356 pixels
</span><span class='line'>channels: 3 channels</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<h2 id="tạo-ảnh-avatar-bằng-kĩ-thuật-mask">Tạo ảnh avatar bằng kĩ thuật mask</h2>
<p>Trong phần này, chúng ta sẽ tạo ra ảnh avatar từ một bức hình chân dung ban đầu, theo dạng như avatar picture của Google+: hình tròn bao quanh khuôn mặt. Đoạn code như sau:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span>create_avatar_circle.py </span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre>
</td>
<td class="code">
<pre><code class='py'><span class='line'><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">cv2</span>
</span><span class='line'>
</span><span class='line'><span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class='line'><span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">,</span> <span class="s">&quot;--image&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
</span><span class='line'>                <span class="n">help</span> <span class="o">=</span> <span class="s">&quot;Path to the image&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">ap</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&quot;image&quot;</span><span class="p">])</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;Original&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="n">cX</span><span class="p">,</span> <span class="n">cY</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="n">radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span class='line'><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s">&quot;uint8&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">cX</span><span class="p">,</span> <span class="n">cY</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">masked</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">)</span>
</span><span class='line'><span class="n">avatar</span> <span class="o">=</span> <span class="n">masked</span><span class="p">[</span> <span class="n">cY</span> <span class="o">-</span> <span class="n">radius</span> <span class="p">:</span> <span class="n">cY</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cX</span> <span class="o">-</span> <span class="n">radius</span> <span class="p">:</span> <span class="n">cX</span> <span class="o">+</span> <span class="n">radius</span><span class="p">]</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;Mask&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;Avatar&quot;</span><span class="p">,</span> <span class="n">avatar</span><span class="p">)</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s">&quot;avatar.jpg&quot;</span><span class="p">,</span> <span class="n">avatar</span><span class="p">)</span>
</span><span class='line'><span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Đoạn code bắt đầu với các thủ tục như import packages cần thiết, khai báo các parameters đầu vào cho script, đọc file ảnh vào mảng NumPy như phần trên.</p>
<p>Để crop một phần bức ảnh, chúng ta cần tạo ra một mặt nạ <code>mask</code>, là một mảng có kích thước như bức ảnh với tất cả giá trị pixel được khởi tạo bằng 0. Tiếp đó, ta vẽ một hình tròn trắng trên mảng ‘mask’ . Sau đó, sử dụng <code>bitwise_and()</code> hai mảng <code>image</code> với nhau, có thêm tham số mặt nạ <code>mask</code>, ta được một bức ảnh <code>masked</code> chỉ có phần khuôn mặt. Tiếp tục crop bằng cách slice mảng NumPy, chúng ta được kết quả cuối cùng là bức ảnh <code>avatar</code>.</p>
Chạy đoạn code trên như sau:
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
</pre>
</td>
<td class="code">
<pre><code class=''><span class='line'>% python create_avatar_circle.py -i obama_fun.jpg</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Kết quả:</p>
<ul>
<li>Bức ảnh ban đầu</li>
</ul>
<p><img src="/images/pythonopencv/original.gif"></p>
<ul>
<li><code>mask</code></li>
</ul>
<p><img src="/images/pythonopencv/mask.gif"></p>
<ul>
<li><code>avatar</code></li>
</ul>
<p><img src="/images/pythonopencv/avatar.gif"></p>
<p>Tất nhiên, tôi đã sử dụng file ảnh có mặt tổng thống Obama ở ngay giữa tấm ảnh và mask được đặt ở chính giữa tâm bức ảnh. Không phải mọi tấm ảnh đều như vậy; trong trường hợp đó chúng ta sẽ sử dụng kĩ thuật face detection. Nhưng đó là chủ đề của một bài viết sau.</p>
<h2 id="kết-luận">Kết luận</h2>
<p>Qua bài viết này, tôi đã giới thiệu những bước bắt đầu để làm việc với OpenCV qua Python. Bài viết khá cơ bản, nhưng đã trình bày một số khái niệm cơ bản để chuẩn bị cho những ứng dụng lần sau. Hẹn gặp lại các bạn trong các phần tiếp theo.</p>
<h1 id="tài-liệu-tham-khảo">Tài liệu tham khảo</h1>
<ol type="1">
<li><a href="http://opencv-python-tutroals.readthedocs.org/en/latest/index.html">OpenCV-Python Tutorials</a></li>
</ol>
		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-09-08T22:14:00+09:00" data-updated="true" itemprop="datePublished">Sep 8<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
			<span class="comments"><a href="/blog/2014/09/08/tong-ket-ban-dieu-tra-ve-thoi-quen-programmer-cua-blog-ktmt/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/09/08/tong-ket-ban-dieu-tra-ve-thoi-quen-programmer-cua-blog-ktmt/" itemprop="url">Tổng Kết Bản điều Tra về Thói Quen Programmer Của Blog Ktmt</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Thời gian vừa rồi blog ktmt có tạo một bản điều tra về các thói quen của lập trình viên ở Việt Nam nói chung. Bản điều tra nằm ở đường link:</p>
<p><a href="https://ktmt.typeform.com/to/WzOLiB" class="uri">https://ktmt.typeform.com/to/WzOLiB</a></p>
<p>Những bạn nào vẫn chưa làm mà có hứng thú làm thì nhóm bọn mình vẫn hết sức welcome.</p>
<p>Bản điều tra có mục đích chính là để tìm hiểu thực trạng và thói quen của các lập trình viên Việt Nam, qua đó điều chỉnh các bài viết của blog sao cho có ích với càng nhiều người càng tốt.Ở bài viết này mình sẽ tổng kết về một số con số mà mình cảm thấy thú vị, hy vọng có ích với mọi người.</p>
<p>Đầu tiên là tính đến thời điểm viết bài này, bản điều tra nhận được 256 câu trả lời trên tổng số 416 lượt visits (tỉ lệ là cứ 5 người xem thì 3 người trả lời). Thời gian trả lời trung bình mất tầm 4 phút, và tỉ lệ hoàn thành 100% bản điều tra là 62% (Tuy nhiên phần lớn các câu hỏi đều có tỉ lệ trả lời tiệm cận 99%, thế nên con số 62% này không có giá trị lắm)</p>
<p><img src="/images/ktmt-survey/ktmt-survey1.png"></p>
<p>Sau đây là một số kết quả thú vị, mình sẽ đi lần lượt các câu hỏi từ trên xuống:</p>
<ul>
<li><ol type="1">
<li>Câu hỏi số năm kinh nghiệm: Các lập trình viên của Việt Nam đều khá trẻ, chủ yếu từ 1-3 năm kinh nghiệm. Các dải kinh nghiệm còn lại trải đều và giảm dần theo số năm.</li>
</ol></li>
<li><ol start="2" type="1">
<li>Câu hỏi về ngôn ngữ lập trình thành thạo: Câu hỏi này có kết quả không ngạc nhiên khi kết quả trải rất đều ở tất cả các ngôn ngữ. Đứng đầu là 3 ngôn ngữ có thể coi là “main stream” nhất là Java, C, C++. Lý do theo cá nhân mình là 3 ngôn ngữ này được dạy nhiều nhất trong đại học Việt Nam. Tiếp đến là các ngôn ngữ để làm web gồm có PHP/Javascript/Ruby/Python.Một số bạn cũng đã tìm hiểu và nắm vững được các ngôn ngữ mới như Scala hay Haskell, rất đáng hoan ngênh.</li>
</ol></li>
<li><ol start="3" type="1">
<li>Câu hỏi về nền tảng đã từng lập trình không có gì bất ngờ khi đi đầu là Windows, tiếp đến là Web và mobile(Android/iOS)</li>
</ol></li>
<li><ol start="4" type="1">
<li>Câu hỏi về IDE: Các lập trình viên Việt Nam khá ưa chuộng sublime text, có lẽ do tính thân thiện của Editor này. Theo sau đó là Eclipse/Vim. Visual Studio về đích với vị trí thứ 4, phải chăng lập trình trên nền dotnet đã không còn là xu hướng.</li>
</ol></li>
<li><ol start="5" type="1">
<li>Câu hỏi về lĩnh vực yêu thích: Lĩnh vực được quan tâm nhất là Web, theo sau đó mới là mobile. Ngoài ra có một số không nhỏ các bạn quan tâm đến bảo mật hay data mining, rất thú vị.</li>
</ol></li>
<li><ol start="6" type="1">
<li>Có 81% các bạn ngoài công việc/trường lớp có làm các project cá nhân. Đây quả thật đây là một con số đáng khích lệ vô cùng.</li>
</ol></li>
<li><ol start="7" type="1">
<li>Github không có gì lạ chính là dịch vụ quản lý source code được yêu thích nhất(47%). Tuy nhiên có tới 25% các bạn quản lý source code chỉ trên máy cá nhân, mà việc này khá nguy hiểm khi máy tính hỏng hóc.</li>
</ol></li>
<li><ol start="8" type="1">
<li>Có 50% các bạn đã từng đặt câu hỏi trên Stackoverflow và 50% chưa từng. Có lẽ ngôn ngữ chính là rào cản lớn nhất của việc này.</li>
</ol></li>
<li><ol start="9" type="1">
<li>Ngược lại với kết quả ở &lt;8&gt;, có tới 85% câu trả lời cho các vấn đề lập trình được các bạn tìm thấy trên Stackoverflow. Có lẽ Stackoverflow chỉ được coi là một cái “kho” để tìm kiếm chứ vẫn chưa được coi là một “diễn đàn” để mọi người đóng góp ý kiến hay trả lời giúp người khác.</li>
</ol></li>
<li><p>10/11. 50% số bạn trả lời sau khi tìm được câu trả lời cho điều mình tìm kiếm thì không lưu lại, có lẽ mọi người cho rằng tìm được kết quả là được, không quan tâm lắm đến việc lần sau gặp lại lỗi đấy thì sẽ phải mất công tìm lại lần nữa.</p></li>
<li><ol start="12" type="1">
<li>70% các bạn trả lời là có viết blog kĩ thuật cá nhân! Đây đúng là một con số rất đáng mừng.</li>
</ol></li>
<li><ol start="13" type="1">
<li>Trong những bạn có viết blog thì 40% là để memo lại các lỗi đã gặp, còn lại là các đoạn code yêu thích hoặc nội dung khác.</li>
</ol></li>
<li><ol start="14" type="1">
<li>Có tới 61% các bạn ngại viết blog vì: “Cảm thấy năng lực chưa đủ”. Đây có lẽ là một lý do rất đáng e ngại, bởi vì mọi mọi người vẫn còn “sợ” bị người khác nhìn vào và chê kém.</li>
</ol></li>
</ul>
<p>Trên đây là một số con số mình thấy khá thú vị và đã tổng kết lại. Rất cám ơn mọi người đã làm bản điều tra giúp bọn mình! Hy vọng mọi người tiếp tục ủng hộ blog trong thời gian tới!!!!</p>
		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-08-23T21:35:00+09:00" data-updated="true" itemprop="datePublished">Aug 23<span>rd</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/openssl/'>openssl</a>


</div>
		
			<span class="comments"><a href="/blog/2014/08/23/android-ndk-va-openssl/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/08/23/android-ndk-va-openssl/" itemprop="url">Android Ndk và Openssl (Phần 1)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1 id="mở-đầu">1. Mở đầu</h1>
<p>Gần đây ở công ty tôi có được giao một task khá hay. Công ty tôi có một game viết trên nền tảng android. Game đó viết bằng anđroid, tuy nhiên lại chủ yếu dùng web view để hiển thị. Mặc dù vậy, một số logic như là set session cho user, authenticate cho user thì lại nằm trên android.</p>
<p>Chắc các bạn cũng đã biết, android app được viết bằng java, dịch ra file dex, sau đó được phân phối trên google playstore dưới dạng file apk. Do đó, android app có một điểm yếu cố hữu mà mọi java app đều mắc phải, đó là bảo mật. Điểm yếu bảo mật ở đây là gì? Đó là việc mà mọi java app đều có thể được phân tích ngược (reverse engineer) rất dễ dàng. Việc này bắt nguồn từ bản chất java được dịch ra bytecode ở dạng khá “gần” với ngôn ngữ lập trình thông thường, và bytecode chứa đầy đủ các thông tin cần thiết để bạn có thể dịch lại nguyên vẹn lại chương trình gốc.</p>
<p>Vậy cái điểm yếu bảo mật này liên quan đến cái app tôi đang phụ trách thế nào? Như tôi vừa nói ở trên, trong cái game mà tôi đang phụ trách, logic authenticate cho user sẽ nằm trên phía android. Điều này có nghĩa là trên android app sẽ phụ trách:</p>
<ul>
<li>Mã hoá uuid của người dùng, gửi lên server</li>
<li>Server sẽ nhận uuid đó, và gửi session key về cho user để user set vào cookie.</li>
</ul>
<p>Chắc hẳn sẽ có bạn thắc mắc là qui trình xác thực này quá đơn giản. Đúng vậy, quy trình này quá đơn giản, dẫn đến là việc chỉ cần user A (người xấu) biết uuid của user B (người bị hại) thì A sẽ giả mạo được bất cứ hành động của B như là gửi đồ từ B cho A.</p>
<p>Vậy tại sao không làm một qui trình xác thực tốt hơn, như dùng thêm một token giống như onetime password mà chỉ user đó mới biết được, hay là làm cách nào để “giấu” uuid đi để cho user khác không biết. Đúng là nên như thế! Tuy nhiên vì một số lý do “lịch sử” của legacy code, mà chúng ta không thể thay đổi qui trình xác thực một cách dễ dàng như thế được.</p>
<p>Như vậy thì với flow code hiện tại thì với điểm yếu của android tôi đã nói ở trên thì một người có chút kiến thức lập trình có thể dễ dàng dịch ngược đoạn logic dùng để xác thực mà tôi đã nói ở trên. Mà trong đó có việc <code>mã hoá uuid người dùng</code> mà khi bạn nhìn được logic code thì mã hoá cũng bằng thừa. Lý do tại sao lại bằng thừa vì code hiện tại đang sử dụng “Symmetric Cryptography Algorithm”. Symmetric ở đây có nghĩa là thuật toán mã hoá đối xứng, mà điển hình gồm có những thuật toán như blowfish, AES, DES.</p>
<p>Nói một cách đơn giản thì các loại thuật toán symmetric thì <strong>bên gửi và bên nhận sẽ dùng cùng một key, cùng một intitialize vector</strong> (Các khái niệm này tôi sẽ trình bày kĩ hơn ở phần sau) , do đó chỉ cần dịch ngược được code thì user A (người xấu) sẽ có được key và initialize vector để tạo ra một request hợp lệ sử dụng uuid của user B.</p>
<p>Vậy thì chúng ta phải giải quyết vấn đề này thế nào? Sau một hồi thảo luận với công ty thì tôi nghĩ ra một giải pháp “chữa cháy” tạm thời, đấy là chuyển logic vào native code sử dụng ndk và C, mục đích để đạt được là:</p>
<blockquote>
<p>“Giấu” đi logic mã hoá uuid người dùng, giấu cả các tham số ban đầu như key và initialize vector. Do đó mà user A sẽ không biết làm cách nào để tạo ra một request hợp lệ với uuid của user B.</p>
</blockquote>
<p>Cách giải quyết này tại sao tôi nói là tạm thời, bởi vì user A nếu có thêm một chút hiểu biết về ndk thì sẽ biết được interface cung cấp ở ndk code sẽ được public ra ngoài, do đó thì vẫn có thể tận dụng được điểm này để tạo ra một request hợp lệ. Tuy nhiên do không nghĩ ra giải pháp khác nên tạm thời dùng cách này sẽ hạn chế được các hacker “gà mờ”.</p>
<p>Vậy để đi theo hướng đi này chúng ta cần phải tìm hiểu về 2 thứ đó là : <strong>Android NDK</strong> và cách để sử dụng các thuật toán mã hoá trên ndk (ở đây là sử dụng ngôn ngữ C), đó là <strong>openssl</strong>. Phần giới thiệu hơi dài dòng, nhưng đến đây các bạn đã nắm được tại sao tiêu đề bài viết lại là Android NDK và open SSL.</p>
<p>Dưới đây chúng ta sẽ đi lần lượt về 2 vấn đề cần giải quyết : Android NDK và OpenSSL</p>
<h1 id="android-ndk">2. Android NDK</h1>
<p>Android NDK là một kit phát triển giúp bạn có thể phát triển các phần mềm android mà dựa một phần trên các đoạn code viết trên C hoặc C++. Bạn sẽ cần đến NDK trong các sản phầm cần đến hiệu năng cao, mà khi đó các đoạn code được build ra binary sẽ phát huy hiệu năng tối đa. Các logic code được thực hiện trên ndk ở dứoi đây tôi sẽ gọi chung là native code.</p>
<p>Về cơ chế hoạt động của ndk, bạn có thể hiểu một cách đơn giản như trong hình vẽ dưới đây, app của bạn sẽ tiến hành giao tiếp với native code thông qua một interface gọi là JNI.</p>
<p>Một cách đơn giản, JNI là một bộ giao thức giao tiếp chuẩn của java, giúp cho java code có thể <strong>nói chuyện</strong> được với C/C++ code, có thể <strong>truyền</strong> dữ liệu giữa 2 bên.</p>
<p><img src="/images/ndk-1.png"></p>
<p>Để tham khảo thêm về android ndk, các bạn có thể vào trang chủ của android tại <a href="https://developer.android.com/tools/sdk/ndk/index.html">Trang chủ của android</a>. Dưới đây tôi sẽ tóm tắt các bước cần thiết để sử dụng được ndk.</p>
<h2 id="cài-đặt">Cài đặt</h2>
<p>Cách cài đặt android ndk khá giống với sdk, tức là chỉ đơn thuần là bạn tải bộ ndk về, đặt vào đâu đó. Trong bộ NDK đó sẽ chứa đầy đủ các tool để có thể build được ndk native code từ C/C++ source (bao gồm build script và các file header cần thiết). Quá trình cài đặt có thể hiểu tóm gọn qua đoạn script dưới đây (chạy trên môi trường unix):</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre>
</td>
<td class="code">
<pre><code class=''><span class='line'>wget http://dl.google.com/android/ndk/android-ndk64-r10-darwin-x86.tar.bz2
</span><span class='line'>tar yxvf android-ndk64-r10-darwin-x86.tar.bz2
</span><span class='line'>mv android-ndk64-r10-darwin-x86 ~/
</span><span class='line'>echo "export PATH=$PATH:/~/android-ndk64-r10-darwin-x86" &gt;&gt; ~/.bash_profile
</span><span class='line'>echo "export ANDROID_NDK_ROOT=/Users/huydo/android-ndk64-r10-darwin-x86" &gt;&gt; ~/.bash_profile
</span><span class='line'>source ~/.bash_profile</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Sau khi chạy đoạn script trên thì android ndk đã được thêm vào path của hệ thống, giúp chúng ta có thể gõ các lệnh như <code>ndk-build</code> từ bất kì đâu</p>
<h2 id="sử-dụng">Sử dụng</h2>
<p>Trong bộ ndk bạn down về có chứa sẵn khá nhiều ví dụ về cách sử dụng ndk, từ đơn giản (như hello world) cho đến các ví dụ phức tạp hơn như xử lý ảnh (mà phải thao tác gửi dữ liệu giữa android app và ndk app khá phức tạp). Các bạn có thể tham khảo các ví dụ đó để có cái nhìn thực tế về ndk program. Dưới đây tôi sẽ trình bày ngắn gọn về quá trình sử dụng của tôi.</p>
<p>Như ở hình ở trên thì các bạn thấy là android app và native code sẽ “nói chuyện” với nhau thông qua một “ngôn ngữ” chung gọi là jni. Như vậy sẽ có 2 khả năng xảy ra, dẫn đến 2 ngữ cảnh để sử dụng ndk:</p>
<ul>
<li><ol type="1">
<li>Viết một số logic code quan trọng ở phía native code, và các logic còn lại để ở phía android app như bình thường. Các giao tiếp sẽ được gọi từ phía java thông qua jni. Cách tiếp cận này thuận lợi ở chỗ là chúng ta tận dùng được mọi điểm mạnh của android frame work, và chỉ các logic nào thật cần thiết mới đưa vào native code.</li>
</ol></li>
<li><ol start="2" type="1">
<li>Viết “native activity”, tức là logic của activity như hiển thị, life cycle, gọi các activity khác.. sẽ được code toàn bộ ở trên phía native. Cách này thực tế khá ít sử dụng, thường sử dụng trong trường hợp mà dữ liệu quá khó để truyền đi truyền lại giữa bên java và native, thì việc code luôn cả activity trên native cũng là một lựa chọn cần thiết.</li>
</ol></li>
</ul>
<p>Ở bài viết này tôi sẽ đi theo hướng tiếp cận 1, để giải quyết bài toán theo hướng:</p>
<blockquote>
<p>Đưa logic mã hoá uuid người dùng vào một file C, build ra binary và gọi logic đó trên phía java thông qua JNI.</p>
</blockquote>
<h2 id="coding-và-build">Coding và build</h2>
<p>Để đi theo hướng tiếp cận 1 như đã nói ở trên, chúng ta có thể dễ dàng hình dung công việc phải làm:</p>
<ul>
<li>Step 1: Viết logic code mã hoá trên C, nhận đầu vào là 1 chuỗi mô tả uuid của người dùng, đầu ra là chuỗi đó dã được mã hoá.</li>
<li>Step 2: Build đoạn code đó thành một file thư viện động (.so file) và “Nhúng” file thư viện động đó vào trong android project</li>
<li>Step 3: Viết logic code gọi native code trên java.</li>
</ul>
<h3 id="step-1-cấu-trúc-của-một-file-native-code-viết-trên-c">Step 1: Cấu trúc của một file native code viết trên C</h3>
<p>Thông thường, chúng ta sẽ tạo một folder tên là jni và đặt toàn bộ các đoạn code, header, các thư viện liên quan vào trong đó.</p>
<p><img src="/images/jni-2.png"></p>
<p>File native code viết trên C khá đơn giản, chỉ cần tóm gọn lại trong 2 bước:</p>
<ul>
<li>include thư viện <jni.h></li>
<li>Viết các hàm dựa trên convention của jni để tạo ra các “interface”, và phía java sẽ gọi được các “interface” này một cách khá dễ dàng</li>
</ul>
<p>Một ví dụ hết sức về native code như dưới đây:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span>hello_jni.c </span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre>
</td>
<td class="code">
<pre><code class='c'><span class='line'><span class="cp">#innclude &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;jni.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">jstring</span>
</span><span class='line'><span class="nf">Java_com_example_hellojni_HelloJni_stringFromJNI</span><span class="p">(</span> <span class="n">JNIEnv</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span>
</span><span class='line'>                                                  <span class="n">jobject</span> <span class="n">thiz</span> <span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;Hello from JNI ! &quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Các bạn để ý tên hàm của native code sẽ dễ dàng nhận thấy convention như trong hình dưới đây:</p>
<p><img src="/images/jni-1.png"></p>
<p>Nhờ có convention đó mà các bạn sẽ thấy việc gọi logic của hàm đó trên phía java sẽ dễ dàng hơn bao giờ hết.</p>
<p>Ngoài ra các bạn có thể để ý một số điểm đặc biệt ở một đoạn native code như dưới đấy:</p>
<ul>
<li>Giá trị trả về ở đây là jstring, đó là một kiểu dữ liệu đặc biệt của jni, mà khi phía java gọi, thư viện jni sẽ thực hiện chuyển đổi (marshalling) giá trị này về kiểu String của java.</li>
<li>Biến JNIEvn* env, bạn có thể hình dung đây là một con trỏ trỏ đến VirtualMachine (Dalvik) của android, nhờ có env này mà chúng ta có thể thao tác ngược từ phía native, để có thể sử dụng được các logic phía android. Như trong đoạn code trên thì chúng ta có thể thấy nhờ có env mà chúng ta có thể tạo được một unicode string từ trong C code.</li>
</ul>
<h3 id="step-2-build-đoạn-code-đó-thành-.so-file">Step 2: Build đoạn code đó thành .so file</h3>
<p>Để build được file native C mà chúng ta vừa viết ở trên, chúng ta cần làm 2 việc:</p>
<ul>
<li>Tạo 2 file Android.mk và Application.mk trong thư mục jni mà chúng ta đã nhắc đến ở trên</li>
<li>Android.mk có nhiệm vụ “miêu tả” module với hệ thống build. Trong file này chúng ta sẽ viết là module chúng ta có những file gì, path ở đâu, sử dụng những thư viện khác nào (dependency). Trong một app có thể có nhiều file Android.mk khi mà chúng ta có nhiều module.</li>
<li>Application.mk sẽ có nhiệm vụ “miêu tả” app của chúng ta với hệ thống build. Thông thường trong file này chúng ta sẽ mô tả những modules mà app sẽ dùng, cũng như là mô tả về CPU architecture mà app sẽ hỗ trợ (mà điển hình gồm có ARM, x86 và MIPS)</li>
<li>Build sử dụng ndk-build hết sức đơn giản chỉ bằng việc gõ lệnh <code>ndk-build</code> ở trong folder hiện tại.</li>
</ul>
<p><img src="/images/ndk-2.png"></p>
<p>Sau khi sử dụng lệnh ndk-build để build thì kết quả build là các file .so sẽ được copy vào thư mục <strong>libs</strong> ở root folder theo như hình trên đây. Các bạn có thể thấy là tương ứng với mỗi kiến trúc CPU sẽ có một folder được tạo ra, trong mỗi folder đó lại có các file .so khác nhau chỉ dùng với duy nhất một kiến trúc nhất định.</p>
<h3 id="step-3-viết-logic-code-gọi-native-code-trên-java">Step 3: Viết logic code gọi native code trên java</h3>
<p>Đã build xong thư viện tĩnh, chúng ta chỉ còn một công đoạn cuối cùng là sử dụng đoạn logic ở trên trong android code. Theo như ở trên đã nói, interface của jni code sẽ được sử dụng dựa theo convention mà gồm có: package name, class name và cfunction name. Điều đó có nghĩa là: đoạn code java trong android của bạn sẽ phải có package name, class name và function name y hệt như interface của jni, thì bạn mới sử dụng được logic đó.</p>
<p>Vậy thì theo như ví dụ của chúng ta ở đây thì chúng ta cần phải làm 3 việc:</p>
<ul>
<li>package name của đoạn code phải là com/example/hellojni</li>
<li>Class name phải là HelloJni</li>
<li>Bạn phải định nghĩa một hàm tên là stringFromJNI để gọi được logic từ native code.</li>
</ul>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span>HelloJni.java </span>
</figcaption>
<div class="highlight">
<table>
<tr>
<td class="gutter">
<pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre>
</td>
<td class="code">
<pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">hellojni</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloJni</span> <span class="kd">extends</span> <span class="n">Activity</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">TextView</span>  <span class="n">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>        <span class="n">tv</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span> <span class="n">stringFromJNI</span><span class="o">()</span> <span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">tv</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">native</span> <span class="n">String</span>  <span class="nf">stringFromJNI</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;hello-jni&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre>
</td>
</tr>
</table>
</div>
</figure>
</notextile>
</div>
<p>Từ đoạn code trên chắc các bạn đã hình dung ra cách để gọi native code thế nào dựa vào hàm <code>System.loadLibrary(&quot;hello-jni&quot;)</code> và việc định nghĩa hàm thông qua directive <code>native</code></p>
<p>Như vậy chúng ta đã tìm hiểu rất sơ qua về ndk. Trong phần tiếp theo, tôi sẽ đi vào phần chính mà tôi muốn nói đến, đó là giới thiệu về openssl và sử dụng openssl trên android ndk.</p>
		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/blog/page/3/" class="prev">Prev</a>
    
    
        <a href="/blog/page/5/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    kỹ thuật máy tính


</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'ktmt';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41828637-2', 'ktmt.github.io');
  ga('send', 'pageview');

</script>	


		</div>
	</div>
</body>
</html>
